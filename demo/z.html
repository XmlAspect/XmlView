<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title> XmlView - render XML as table demo </title>
</head>
<body >
    <h1> XmlView - render XML as table demo </h1>
	<hr />
    <main id="mainDemo"></main>
<script type="module">
    import {loadXml,Transform, toggleSort} from '../xml-toolkit.js'
    const   modUrl  = relUrl => new URL(relUrl, import.meta.url).pathname;
    const xml        = await loadXml( modUrl('./books.xml'          ) )
    // ,     xslParams  = await loadXml( modUrl('../TableParams.xsl'   ) )
    ,     xslAsTable = await loadXml( modUrl('../AsTable.xsl'       ) );

    // const xmlParams = Transform( xml, xslParams, xml.createElement('xv:params') );
    // xslAsTable.documentElement.append(xmlParams);
    const outNode = Transform( xml, xslAsTable, mainDemo );
// Transform( xml, xslAsTable, mainDemo );
    const xml2clipboard = xml =>
    ( function setClipboard(text) {
            var type = "text/plain";
            var blob = new Blob([text], { type });
            var data = [new ClipboardItem({ [type]: blob })];

            return navigator.clipboard.write(data).then(
                function () {
                    console.log('success');
                },
                function () {
                    console.log('failure');
                }
            );
        }
    )( new XMLSerializer().serializeToString( xml ) )

    document.addEventListener('click', onSortCommand);
    document.addEventListener('keypress', onKeyPress);

    function onKeyPress( ev ){   if( ev.keyCode == 32 ) return onSortCommand( ev ); }
    function onSortCommand( ev )
    {
        try
        {   const p = ev.target.parentElement.parentElement.parentElement.parentElement.dataset.path
            ,   h = ev.target.href;
            if( !h || !h.includes('#') || !p )
                return;
            ev.preventDefault();
            toggleSort( xslAsTable, p, ev.target.getAttribute('href').substring(1) );
            Transform( xml, xslAsTable, mainDemo );
            xml2clipboard( xslAsTable );
        }catch( err ){}
    }

</script>
</body>
</html>
